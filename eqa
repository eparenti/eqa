#!/usr/bin/env bash
# exercise-qa-4: Student simulation testing for Red Hat Training exercises
#
# Usage:
#   eqa AU0024L                      # test all exercises in a lesson
#   eqa AU0024L scale-files           # test one exercise
#   eqa AU294 --chapter 4             # test chapter 4
#   eqa --help                       # full options

# Detect where this script is installed (resolves symlinks)
# Use readlink -f if available, otherwise use cd trick
if command -v readlink >/dev/null 2>&1; then
    EQA_SCRIPT="$(readlink -f "${BASH_SOURCE[0]}")"
    EQA_DIR="$(dirname "$EQA_SCRIPT")"
else
    # Fallback for systems without readlink -f
    SOURCE="${BASH_SOURCE[0]}"
    while [ -h "$SOURCE" ]; do
        DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
        SOURCE="$(readlink "$SOURCE")"
        [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
    done
    EQA_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
fi

# Save the directory where the user ran eqa (for relative output paths)
export EQA_CALLER_DIR="$PWD"

# Run the Python module
cd "$EQA_DIR" && exec python3 -u -m src.main "$@"
